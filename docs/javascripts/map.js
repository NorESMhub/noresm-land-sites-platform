// Site GEOJSON - update manually!

var nlpSites = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          8.12343,
          61.0243
        ]
      },
      "properties": {
        "name": "ALP1",
        "long_name": "Ulvehaugen",
        "description": "Alpine vegetation at 1208 m elevation. Mean summer temperature is 7 degrees C, and mean annual precipitation is 1226 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/ALP1.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          7.27596,
          60.8231
        ]
      },
      "properties": {
        "name": "ALP2",
        "long_name": "Laavisdalen",
        "description": "Alpine vegetation at 1097 m elevation. Mean summer temperature is 7 degrees C, and mean annual precipitation is 1561 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/ALP2.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          7.17561,
          60.8328
        ]
      },
      "properties": {
        "name": "ALP3",
        "long_name": "Gudmedalen",
        "description": "Alpine vegetation at 1213 m elevation. Mean summer temperature is 6.5 degrees C, and mean annual precipitation is 2130 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_ALP3",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/ALP3.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          6.41504,
          60.9335
        ]
      },
      "properties": {
        "name": "ALP4",
        "long_name": "Skjellingahaugen",
        "description": "Alpine vegetation at 1088 m elevation. Mean summer temperature is 7 degrees C, and mean annual precipitation is 3402 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_ALP4",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/ALP4.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          8.70466,
          60.8203
        ]
      },
      "properties": {
        "name": "SUB1",
        "long_name": "Aalrust",
        "description": "Sub-alpine vegetation at 815 m elevation. Mean summer temperature is 9 degrees C and mean annual precipitation is 789 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_SUB1",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/SUB1.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          7.17666,
          60.8760
        ]
      },
      "properties": {
        "name": "SUB2",
        "long_name": "Hoegsete",
        "description": "Sub-alpine vegetation at 700 m elevation. Mean summer temperature is 9 degrees C and mean annual precipitation is 1356 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_SUB2",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/SUB2.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          6.63028,
          61.0866
        ]
      },
      "properties": {
        "name": "SUB3",
        "long_name": "Rambaera",
        "description": "Sub-alpine vegetation at 769 m elevation. Mean summer temperature is 8.7 degrees C and mean annual precipitation is 1848 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_SUB3",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/SUB3.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          6.51468,
          60.5445
        ]
      },
      "properties": {
        "name": "SUB4",
        "long_name": "Veskre",
        "description": "Sub-alpine vegetation at 797 m elevation. Mean summer temperature is 8.6 degrees C and mean annual precipitation is 3029 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_SUB4",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/SUB4.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          9.07876,
          61.0355
        ]
      },
      "properties": {
        "name": "BOR1",
        "long_name": "Fauske",
        "description": "North-boreal vegetation at 589 m elevation. Mean summer temperature is 10.3 degrees C and mean annual precipitation is 600 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_BOR1",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/BOR1.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          7.16982,
          60.8803
        ]
      },
      "properties": {
        "name": "BOR2",
        "long_name": "Vikesland",
        "description": "North-boreal vegetation at 474 m elevation. Mean summer temperature is 10.5 degrees C and mean annual precipitation is 1161 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_BOR2",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/BOR2.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          6.33738,
          60.6652
        ]
      },
      "properties": {
        "name": "BOR3",
        "long_name": "Arhelleren",
        "description": "North-boreal vegetation at 431 m elevation. Mean summer temperature is 10.6 degrees C and mean annual precipitation is 2044 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_BOR3",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/BOR3.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          5.96487,
          60.6901
        ]
      },
      "properties": {
        "name": "BOR4",
        "long_name": "Oevstedal",
        "description": "North-boreal vegetation at 346 m elevation. Mean summer temperature is 10.8 degrees C and mean annual precipitation is 2923 mm.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_BOR4",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/BOR4.zip",
        "group": "SeedClim"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          25.29547425,
          69.3408715
        ]
      },
      "properties": {
        "name": "ISK",
        "long_name": "Iskoras",
        "description": "",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_ISK",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/ISK.zip",
        "group": "LATICE-MIP"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          12.25481033,
          61.10516357
        ]
      },
      "properties": {
        "name": "HIS1",
        "long_name": "Hisaasen_up",
        "description": "",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_HIS1",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/HIS1.zip",
        "group": "LATICE-MIP"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          12.25089836,
          61.1115036
        ]
      },
      "properties": {
        "name": "HIS2",
        "long_name": "Hisaasen_low",
        "description": "",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_HIS2",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/HIS2.zip",
        "group": "LATICE-MIP"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          11.078142,
          60.372387
        ]
      },
      "properties": {
        "name": "HUR",
        "long_name": "Hurdal",
        "description": "",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_HUR",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/HUR.zip",
        "group": "LATICE-MIP"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          7.527008533,
          60.59383774
        ]
      },
      "properties": {
        "name": "FNS",
        "long_name": "Finse_fluxtower",
        "description": "Above current climatic tree- and forest lines. Alpine ridges, wetlands, lakes, heather and snowbed vegetation.",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_FNS",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/FNS.zip",
        "group": "LATICE-MIP"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          11.83334,
          78.92094
        ]
      },
      "properties": {
        "name": "BYV",
        "long_name": "Bayelva",
        "description": "",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_BYV",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/BYV.zip",
        "group": "LATICE-MIP"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          15.91667,
          78.18333
        ]
      },
      "properties": {
        "name": "ADV",
        "long_name": "Adventdalen",
        "description": "",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_ADV",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/ADV.zip",
        "group": "LATICE-MIP"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          10.781667,
          59.660278
        ]
      },
      "properties": {
        "name": "AAS",
        "long_name": "Aas",
        "description": "",
        "compset": "2000_DATM%GSWP3v1_CLM51%FATES_SICE_SOCN_MOSART_SGLC_SWAV",
        "res": "1x1_AAS",
        "data_url": "https://raw.githubusercontent.com/NorESMhub/noresm-lsp-data/main/sites/AAs.zip",
        "group": "LATICE-MIP"
      }
    }
  ]
};

// Map object
var map = L.map('map').setView([64.616667, 16.65], 2);

// Base map
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

// Site marker display options
var geojsonMarkerOptions = {
    radius: 6,
    fillColor: "#ff7800",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.9
};


// Functions for hovering and clicking sites

function highlightFeature(e) {
    var layer = e.target;

    layer.setStyle({
        weight: 3,
        color: '#000',
		fillColor: '#DCDCDC',
        dashArray: '',
        fillOpacity: 0.7
    });

    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
    }
	info.update(layer.feature.properties);
}

var geojson;

function resetHighlight(e) {
    geojson.resetStyle(e.target);
	info.update();
}

//function zoomToFeature(e) {
//   map.setView(e.latlng, 7);
//}


function onEachFeature(feature, layer) {
	layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight//,
        //click: zoomToFeature
    });
    // Display box with site group name on click
    if (feature.properties && feature.properties.name) {
        layer.bindPopup(
          '<b>' + feature.properties.name +
          '</b><br><span>' + feature.properties.description +'</span>'
          );
    }
}

// Apply to geojson

geojson = L.geoJSON(nlpSites, {
    pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, geojsonMarkerOptions);
    },
	style: function(feature) {
        switch (feature.properties.group) {
            case 'SeedClim': return {fillColor: "#50c878"};
            case 'LATICE-MIP': return {fillColor: "#4169E1"};
        }
    },
	onEachFeature: onEachFeature
}).addTo(map);


// Add a legend

function getColor(d) {
        return d === 'SeedClim'  ? "#50c878" :
               d === 'LATICE-MIP'  ? "#4169E1" :
                            "#ff7f00"; //Other
    }

var legend = L.control({position: 'bottomleft'});

legend.onAdd = function(map) {
    var div = L.DomUtil.create('div', 'info legend');
    labels = ['<strong>Site family</strong>'],
    categories = ['SeedClim', 'LATICE-MIP'];

    for (var i = 0; i < categories.length; i++) {

            div.innerHTML +=
            labels.push(
                '<i class="fa fa-circle" style="color:' + getColor(categories[i]) + '"></i> ' +
            (categories[i] ? categories[i] : '+')
			);

        }
        div.innerHTML = labels.join('<br>');
    return div;
    };
legend.addTo(map);

// Add info box
var info = L.control();

info.onAdd = function (map) {
    this._div = L.DomUtil.create('div', 'info site-info'); // create a div with a class "info"
    this.update();
    return this._div;
};

// method that we will use to update the control based on feature properties passed
info.update = function (props) {
    this._div.innerHTML = '<h4>Site info</h4>' +  (props ?
        '<b>' + props.name + '</b><br />' + 'Click for more info.'
        : 'Hover over a site to display its name here.');
};

info.addTo(map);

// Reset zoom button
(function() {
	var control = new L.Control({position:'topleft'});
	control.onAdd = function(map) {
			var azoom = L.DomUtil.create('a','resetzoom leaflet-bar');
			azoom.innerHTML += '<i class="fa fa-refresh" aria-hidden="true"></i>';
			L.DomEvent
				.disableClickPropagation(azoom)
				.addListener(azoom, 'click', function() {
					map.setView([64.616667, 16.65], 4);
				},azoom);
			return azoom;
		};
	return control;
}())
.addTo(map);
